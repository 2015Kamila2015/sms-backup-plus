<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <title>
      SMS Backup+ error report
    </title>

    <style type="text/css">
      A:link {text-decoration: none }
      body {
         font-family: Arial;
         border: 0 none;
      }
    </style>

    <script type="text/javascript" src="http://www.google.com/jsapi"></script>
    <script type="text/javascript">
      google.load('visualization', '1', {packages: ['corechart', 'table']});
    </script>
    <script type="text/javascript">
      function show(spreadsheet, analysis, analysisContainer) {
        var q = new google.visualization.Query(spreadsheet);
        q.setQuery(analysis['query']);

        q.send(function(response) {
          var spinner = document.getElementById('spinner');
          var toc = document.getElementById('toc-' + analysis['id']);
          if (toc) toc.style.display = '';
          if (spinner) spinner.style.display = "none";

          if (response.isError()) {
            var errors  = document.getElementById('errors');
            errors.innerHTML = 'Error in query: ' + response.getMessage() +
                               ' ' + response.getDetailedMessage();
          } else {
            var data = response.getDataTable();
            var id = analysis['id'];

            var container = document.createElement('div');
            container.setAttribute('id', id + '-' + 'table');
            analysisContainer.appendChild(container);

            var table = new google.visualization.Table(container);
            table.draw(data, {title: analysis['title']});

            var view = new google.visualization.DataView(data);
            var columns = view.getViewColumns();

            // produce one piechart per pivot point
            for (var i=1; i<columns.length; i++) {
              view.setColumns([0, columns[i]]);

              var version = view.getColumnLabel(1);
              if (version && !(version === "")) {
                var container = document.createElement('div');
                container.setAttribute("id", id + '-' + version);
                analysisContainer.appendChild(container);

                var piechart = new google.visualization.PieChart(container);
                piechart.draw(view, {legend: 'bottom',
                                     pieSliceText: 'label',
                                     height: 500,
                                     title: analysis['title'] + ': App version ' + version});
              }
            }
          }
        });
      }

      google.setOnLoadCallback(function() {
        var sheet = document.getElementById('spreadsheet');
        if (sheet) {
          // N = model, B = version, F = android_version
          var reports = [
            {
              id: 'crash-by-version',
              query: 'SELECT F, COUNT(A) GROUP BY F PIVOT B',
              title: 'Number of crashes by Version of Android'
            },
            {
              id: 'crash-by-model',
              query: 'SELECT N, COUNT(A) GROUP BY N PIVOT B',
              title: 'Number of crashes by Android model',
            }
          ];

          for (var i=0; i<reports.length;i++) {
            var q = reports[i];

            var li = document.createElement('li');
            li.setAttribute('id', 'toc-' + q['id']);
            li.style.display = 'none';
            document.getElementById('toc').appendChild(li);
            var a = document.createElement("a");
            a.href = '#' + q['id'];
            a.innerHTML = q['title'];
            li.appendChild(a);

            var analysisContainer = document.createElement('div');
            analysisContainer.setAttribute('id', q['id']);

            var anchor = document.createElement('a');
            anchor.setAttribute('name', q['id']);
            anchor.innerHTML = q['title'];
            analysisContainer.appendChild(anchor);

            document.getElementById('reports').appendChild(analysisContainer);

            show(sheet.href, q, analysisContainer);
          }
        }
      });
    </script>
  </head>

  <body>
    <h1><a href="http://github.com/jberkel/sms-backup-plus#readme">SMS Backup+</a> error reports</h1>

    <p>
     <a href="https://github.com/jberkel/sms-backup-plus/tree/gh-pages#readme">What is this?<a>
    </p>

    <a id="spreadsheet"
       href="https://spreadsheets.google.com/ccc?key=0At-v8_qu4q4VdFZOM3JNWng5bmZYLXNCWFJ0b1hPdHc&authkey=CMKWmssL">
      Spreadsheet
    </a>

    <span id="spinner">
      loading, please wait...
    </span>

    <div id="errors"/>
    <div>
      <ul id="toc">
      </ul>
    </div>
    <div id="reports"/>
  </body>
</html>
